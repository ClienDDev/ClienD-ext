<?xml version="1.0" encoding="UTF-8"?>
<project name="Cliend extension" basedir = "./" default="init" description="Building project">
	<!--
	КАК СОБИРАТЬ
	
	1) Скачать Phing, распаковать
	2) Зайти в {директория_phing}/bin и открыть файл phing.bat.
	3) Отредактировать в этом файле 44 строчку (путь к PHP интерпретатору. PHP должен быть 5,2+ версии и с установленным
	PEAR)
	4) Переместиться в {директория_репозитория_Cliend}/
	5) Запустить команду {директория_phing}/bin/phing.bat -f build/build.xml
	6) После окончания сброки, чтобы найти собранную копию проекта, нужно подняться на один уровень вверх от репозитория
	и перейти в папку ext_build.
	-->
	
	<!--Директория для собранного проекта (на один уровень вверх от репозитория, подпапка cliend_build-->
	<property override="false" name="build_dir" value="${basedir}/../../ext_build"/>
	
	<!--Директория для собранного проекта-->
	<property override="false" name="project_dir" value="${build_dir}/project"/>
	
	<!--Директория для документации-->
	<property override="false" name="docs_dir" value="${build_dir}/docs"/>
	
	<!--Подключение инструментов PHING-->	
	<taskdef name="lessc" classname="phing.rych.tasks.LessCompilerTask" /> <!--LESSC-->
	<taskdef name="minify" classname="phing.my.kpMinTask" /> <!--YUI compressor-->
	<property override="false" name="yui_path" value="${phing.home}\..\yuicompressor.jar"/>
	<property override="false" name="phpdoc_path" value="${phing.home}\..\phpdoc2\bin\phpdoc.bat"/>
	
	
	<!--JS файлы, которые надо сжать-->
    <fileset dir="${project_dir}/" id="fileset.js">
        <include name="bg.js" />
		<include name="sites.js" />
    </fileset>
	
	
	<target name="init" depends="copy_files, minifycss, minifyjs, clear_excess">
		<echo>Completed</echo>
	</target>
	
	<target name="prepare_copy">
		<echo>Preparing to copying (create directories)</echo>
		
		<echo>Deleting directories (they should be empty)</echo>
		<delete dir="${build_dir}" includeemptydirs="true" verbose="true" />
		<delete dir="${docs_dir}" includeemptydirs="true" verbose="true" />
		<delete dir="${project_dir}" includeemptydirs="true" verbose="true" />

		<echo>Create directories</echo>
		<mkdir dir="${build_dir}"></mkdir>
		<mkdir dir="${docs_dir}"></mkdir>
		<mkdir dir="${project_dir}"></mkdir>
	</target>
	
	<target name="copy_files" depends="prepare_copy">
		<echo>Copying...</echo>
		<copy todir="${project_dir}" >
			<fileset dir=".">
				<exclude name="build/**"/>
				<exclude name=".git/**"/>
                <exclude name=".gitignore"/>
			</fileset>
		</copy>
	</target>
	
	<target name="lessc">
		<echo msg="LESS compilation" />
		<lessc targetdir="${project_dir}/styles">
			<fileset dir="${project_dir}/styles">
				<include name="*.less" />
			</fileset>
		</lessc>
	</target>
	
	<target name="minifyjs">
		<echo msg="Minifying JavaScript files..." />
		<minify targetDir="${project_dir}/js/" yuiPath="${yui_path}" type="js">
			<fileset dir="${project_dir}/js/">
				<include name="*.js"/>
			</fileset>
		</minify>
    </target>
	
    <target name="minifycss" depends="lessc">
        <echo msg="Minifying CSS files..." />
        <minify targetDir="${project_dir}/styles" yuiPath="${yui_path}" type="css">
			<fileset dir="${project_dir}/styles">
				<include name="*.css"/>
			</fileset>
		</minify>
    </target>
    
    <target name="clear_excess">
        <echo>Delete excess js</echo>
        <delete>
            <fileset dir="${project_dir}/js">
                <include name="less.min.js"/>
            </fileset>
        </delete>
        
        <echo>Delete excess css</echo>
        <delete>
            <fileset dir="${project_dir}/styles">
                <include name="sites.less"/>
            </fileset>
        </delete>
    </target>
</project>
